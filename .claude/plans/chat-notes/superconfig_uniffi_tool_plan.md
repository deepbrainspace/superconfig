# SuperConfig UniFfi Tool Plan

**Created**: July 27, 2025\
**Status**: Active Development Plan

## Objective

Build a tool that generates and publishes multi-language bindings from a single Rust crate, avoiding code duplication.

## Problem

- napi-rs requires separate crate with duplicated wrapper code
- PyO3 requires separate crate with duplicated wrapper code
- Maintaining 3 copies of the same API is error-prone

## Solution: UniFfi Tool

### Architecture

```
superconfig/
├── crates/
│   ├── superconfig/       # Core library (no changes needed)
│   └── uniffi/           # Our binding generator tool
├── packages/
│   ├── node/             # Generated by uniffi
│   └── python/           # Generated by uniffi
```

### How It Works

1. Analyzes superconfig's public API
2. Generates binding code using napi-rs/PyO3
3. Builds platform binaries
4. Publishes to npm/pypi

### Implementation Steps

#### Phase 1: Node.js MVP (Week 1)

- [ ] Create `crates/uniffi` with basic CLI
- [ ] Parse superconfig's public API using syn
- [ ] Generate napi-rs binding code
- [ ] Build and test Node.js package
- [ ] Publish @superconfig/node to npm

#### Phase 2: Python Support (Week 2)

- [ ] Add PyO3 code generation
- [ ] Build Python wheels
- [ ] Publish to PyPI

#### Phase 3: Generalization (Week 3+)

- [ ] Make tool work for any Rust crate
- [ ] Add more language targets
- [ ] Open source as separate project

### Technical Details

```toml
# crates/uniffi/Cargo.toml
[dependencies]
syn = { version = "2.0", features = ["full"] }
quote = "1.0"
proc-macro2 = "1.0"
toml = "0.8"

# For building
napi-cli = "2.0"
maturin = "1.0"
```

```rust
// Rough structure
pub struct UniFfi {
    crate_path: PathBuf,
    config: Config,
}

impl UniFfi {
    pub fn analyze(&self) -> ApiDefinition { ... }
    pub fn generate_node(&self, api: &ApiDefinition) -> String { ... }
    pub fn generate_python(&self, api: &ApiDefinition) -> String { ... }
    pub fn build_and_publish(&self, target: Target) { ... }
}
```

### Benefits

- Single source of truth
- Automated publishing
- No manual wrapper maintenance
- Can become its own product later

### Naming

- Internal: `uniffi` (crate name)
- If open sourced: TBD based on functionality

---

**Note**: This is the actual plan. Previous strategic documents archived.
